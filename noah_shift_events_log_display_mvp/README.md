# Noah AI Report - Section VI: Shift Events Log Display (MVP)

This directory contains the MVP definition for the data preparation logic and UI outline for displaying Section VI (Shift Events Log) of the AI-Powered Shift Report. This section focuses on presenting a chronological list of patient-related events from the shift, with basic filtering capabilities, using a shared mock data store.

## File Index

1.  **`events_log_data_prep.py`**
    *   **Purpose:** This Python script is responsible for fetching, filtering, and formatting event data that would populate the Shift Events Log. It is designed to read from a shared mock event store.
    *   **Functionality:**
        *   **Shared Mock Event Data Source:**
            *   The script attempts to import `SHARED_MOCK_EVENTS_DB` from `noah_shift_event_capture_agent_mvp/shift_event_capture.py`. This dictionary (keyed by `patient_id`) is intended to be the central in-memory store for events generated by the event capture agent.
            *   If the import fails (e.g., due to path issues in the execution environment or the capture script not having run in the same session), it falls back to a local, pre-defined mock event store (`IMPORTED_SHARED_MOCK_EVENTS_DB` initialized with local data) for demonstration purposes.
        *   `get_mock_shift_events(patient_id: str, filter_criteria: dict = None) -> list`:
            *   Fetches events for a given `patient_id` from the (hopefully imported) `IMPORTED_SHARED_MOCK_EVENTS_DB`.
            *   Simulates basic filtering based on `event_type` and `time_range`.
            *   Returns a list of event dictionaries, sorted by timestamp in descending order.
        *   `format_event_for_display(event_data: dict) -> str`:
            *   Formats a single event dictionary into a human-readable string summary for UI display.
    *   **Example Usage:** The `if __name__ == "__main__":` block demonstrates calling `get_mock_shift_events()` (which attempts to use the shared data) and formatting the results.

2.  **`section_vi_events_log_ui.md`**
    *   **Purpose:** A markdown file outlining a conceptual HTML-like structure for displaying the Shift Events Log (Section VI) and its associated filtering controls.
    *   **Content:**
        *   **Filtering Controls:** UI mockups for:
            *   A dropdown menu to filter by `event_type`.
            *   Datetime input fields for selecting a `time_range` (start and end).
            *   "Apply Filters" and "Clear Filters" buttons.
        *   **Events Display Area:**
            *   An unordered list (`<ul>`) where formatted event strings (generated by `format_event_for_display()`) would be dynamically rendered.
            *   A message area to indicate when no events match the filters or if no events are available.
        *   **Conceptual JavaScript:** Includes comments outlining the JavaScript logic that would handle:
            *   Collecting filter values from the UI controls.
            *   Calling a backend function (simulated by `get_mock_shift_events()`) to fetch and filter data.
            *   Dynamically updating the events list in the UI based on the filtered results.

## How the System Works (Conceptually)

1.  The `events_log_data_prep.py` script simulates the backend logic for fetching and processing event data. In a real system, `get_mock_shift_events()` would query a database (like AlloyDB `EventLogs` table from Step 1) using the provided filters.
2.  The `section_vi_events_log_ui.md` file provides a blueprint for the front-end UI.
3.  When a user interacts with the filter controls on the UI:
    *   Conceptual JavaScript captures the selected filter values.
    *   It requests filtered event data from the backend (simulated by calling `get_mock_shift_events()` which accesses `IMPORTED_SHARED_MOCK_EVENTS_DB`).
    *   The backend returns a list of filtered event dictionaries.
    *   The JavaScript then iterates through the returned events, calls `format_event_for_display()` for each, and updates the HTML list to display the formatted event strings.

## Important Notes

*   **Shared Data Simulation:**
    *   The primary change in this version is the attempt to use a `SHARED_MOCK_EVENTS_DB` imported from the `noah_shift_event_capture_agent_mvp` module. This simulates a shared data layer where events logged by one agent can be read by another.
    *   **Success of Sharing:** The actual sharing depends on the Python execution environment and whether `shift_event_capture.py` has populated its `SHARED_MOCK_EVENTS_DB` in a way that's accessible during the execution of `events_log_data_prep.py`. The script includes fallback mock data if the import or access fails.
    *   **Filtering Logic:** The filtering in `get_mock_shift_events()` remains a basic Python implementation.
*   **UI Blueprint:** The `.md` file is **not** functional UI code.
*   **Date/Time Handling:** The script uses `dateutil.parser` for robust parsing of ISO 8601 timestamp strings.
*   **MVP Focus:** This iteration emphasizes the conceptual link between event capture and event display via a shared (simulated) data store.
